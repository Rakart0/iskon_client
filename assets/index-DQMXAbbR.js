var O=Object.defineProperty;var W=(h,e,t)=>e in h?O(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var r=(h,e,t)=>(W(h,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();const _="v0.02",a=30,u=20,m=10;class S extends EventTarget{constructor(t){super();r(this,"eventDispatcher",new Comment("event-dispatcher"));r(this,"action");this.action=t}register(t,i){this.internalRegister(i.bind(t))}internalRegister(t){this.eventDispatcher.addEventListener(this.action,function(i){t(i)})}dispatch(t){let i=new CustomEvent(this.action,{detail:{data:t}});this.eventDispatcher.dispatchEvent(i)}}const g=class g{constructor(){r(this,"canvas");r(this,"bus");r(this,"_canvasWidth",1600);r(this,"_canvasHeight",900)}static getInstance(){return g.instance||(g.instance=new g),g.instance}get canvasWidth(){return this._canvasWidth}get canvasHeight(){return this._canvasHeight}initialize(e){this.canvas=e,this.bus=new S("resize"),window.onresize=()=>this.handleResize(),this.handleResize(),this.setWindowStyle()}handleResize(){this._canvasWidth=window.innerWidth-m*2,this._canvasHeight=window.innerHeight-m*2,this.canvas.width=this._canvasWidth,this.canvas.height=this._canvasHeight,console.log("DSIPATCH"),this.bus.dispatch({width:this._canvasWidth,height:this._canvasHeight})}subscribe(e,t){this.bus.register(e,t)}setWindowStyle(){let e=document.body;e.style.setProperty("margin-top",`${m}px`),e.style.setProperty("margin-left",`${m}px`)}};r(g,"instance");let y=g;class x{constructor(){r(this,"width");r(this,"height");r(this,"windowHandler")}initialize(){this.windowHandler=y.getInstance(),this.windowHandler.subscribe(this,this.onResize),this.width=this.windowHandler.canvasWidth,this.height=this.windowHandler.canvasHeight}onResize(e){this.width=e.detail.data.width,this.height=e.detail.data.height}}function d(h){return h*Math.PI/180}class l{constructor(e,t){r(this,"x");r(this,"y");r(this,"_oX");r(this,"_oY");r(this,"magnitude");this.x=e,this.y=t,this._oX=e,this._oY=t,this.updateMagnitude()}static fromAngle(e){return new l(Math.cos(e),Math.sin(e))}static zero(){return new l(0,0)}normalize(){this.x=this.x/this.magnitude,this.y=this.y/this.magnitude,this.updateMagnitude()}updateMagnitude(){this.magnitude=Math.sqrt(this.x*this.x+this.y*this.y)}setMagnitude(e){this.magnitude==0&&(this.x=this._oX,this.y=this._oY,this.updateMagnitude()),this.x=this.x*e/this.magnitude,this.y=this.y*e/this.magnitude,this.updateMagnitude()}add(e){return this.x+=e.x,this.y+=e.y,this}sub(e){return this.x-=e.x,this.y-=e.y,this}mult(e){return this.x*=e,this.y*=e,this}copy(){return new l(this.x,this.y)}}class T extends x{constructor(t){super();r(this,"mousePosition");r(this,"worldMousePosition");r(this,"canvas");r(this,"screenTileWidth");r(this,"screenTileHeight");r(this,"bus");r(this,"halfScreen");this.mousePosition=new l(0,0),this.worldMousePosition=new l(0,0),this.bus=new S("click"),this.canvas=t}initialize(){super.initialize(),this.setTileSize(),this.halfScreen=new l(this.canvas.width/2,this.canvas.height/2),this.canvas.onmousemove=t=>this.onMouseMove(t),this.canvas.onclick=t=>this.onMouseClick(t)}registerMouseClick(t,i){this.bus.register(t,i)}onMouseMove(t){this.updateMouseValues(t)}onMouseClick(t){this.updateMouseValues(t),this.bus.dispatch({mousePosition:this.mousePosition,worldMousePosition:this.worldMousePosition})}updateMouseValues(t){let i=t.offsetX,s=t.offsetY,n=Math.floor(-(i-this.halfScreen.x)/this.screenTileWidth+.5+(s-this.halfScreen.y)/this.screenTileHeight),o=Math.floor(-(s-this.halfScreen.y)/this.screenTileHeight+.5+-(i-this.halfScreen.x)/this.screenTileWidth);this.mousePosition.x=i,this.mousePosition.y=s,this.worldMousePosition.x=n,this.worldMousePosition.y=o}setTileSize(){let t=l.fromAngle(d(a)),i=l.fromAngle(d(-a));t.setMagnitude(u/2),i.setMagnitude(u/2);let s=l.zero().add(t).sub(i),n=l.zero().add(t).add(i),o=l.zero().sub(t).add(i),c=l.zero().sub(t).sub(i);this.screenTileHeight=s.y-o.y,this.screenTileWidth=c.x-n.x}onResize(t){super.onResize(t),this.halfScreen=new l(this.width/2,this.height/2)}}const p=class p{constructor(){r(this,"context")}static getInstance(){return p.instance||(p.instance=new p),p.instance}initialize(e){this.context=e}setFill(e){this.context.fillStyle=e}setStroke(e){this.context.strokeStyle=e}clear(e,t){this.context.fillRect(0,0,e,t)}drawShape(e){this.context.beginPath();for(let t=0;t<e.length;t++)this.context.lineTo(e[t].x,e[t].y);this.context.fill()}drawLines(e){this.context.beginPath();for(let t=0;t<e.length;t++)this.context.lineTo(e[t].x,e[t].y);this.context.closePath(),this.context.stroke()}drawCircle(e,t,i){this.context.beginPath(),this.context.arc(e,t,i,0,Math.PI*2),this.context.closePath(),this.context.fill()}translate(e,t){this.context.translate(e,t)}resetTransform(){this.context.setTransform(1,0,0,1,0,0)}setStrokeWidth(e){this.context.lineWidth=e}};r(p,"instance");let C=p;class z extends x{constructor(){super();r(this,"renderables",[]);r(this,"renderer");this.renderer=C.getInstance()}render(){this.preDraw(),this.draw()}preDraw(){}postDraw(){}draw(){this.drawObjects()}drawObjects(){for(let t=0;t<this.renderables.length;t++)this.renderables[t].render(this.renderer)}addObject(t){this.renderables.push(t)}removeObject(t){let i=this.renderables.indexOf(t);this.renderables.splice(i,1)}}class B extends z{}class w{static RGB(e,t,i){return`rgb(${e},${t},${i})`}static RGBA(e,t,i,s){return`rgba(${e},${t},${i},${s/255})`}static grayScale(e){return`rgb(${e},${e},${e})`}}class H{constructor(e){r(this,"position");this.position=e}render(e){}}class P extends H{constructor(t,i,s){super(t);r(this,"points");r(this,"width");r(this,"height");this.width=i,this.height=s,this.points=[]}initialize(){this.createPoints()}createPoints(){}}class A extends P{constructor(e,t,i){super(e,t,i),this.initialize()}render(e){e.drawLines(this.points)}createPoints(){let e=l.fromAngle(d(a)),t=l.fromAngle(d(-a));e.setMagnitude(this.width/2),t.setMagnitude(this.width/2);let i=this.position.copy();i.add(e),i.sub(t);let s=this.position.copy();s.add(e),s.add(t);let n=this.position.copy();n.sub(e),n.add(t);let o=this.position.copy();o.sub(e),o.sub(t),this.points=[i,s,n,o]}}class k extends A{constructor(){super(...arguments);r(this,"isUnder",!1);r(this,"baseColor",w.RGBA(222,105,255,200));r(this,"deleteColor",w.RGBA(201,26,61,125))}render(t){let i=this.points[0].copy().add(this.position),s=this.points[1].copy().add(this.position),n=this.points[2].copy().add(this.position),o=this.points[3].copy().add(this.position);t.setFill(this.isUnder?this.deleteColor:this.baseColor),t.drawShape([i,s,n,o])}createPoints(){let t=l.fromAngle(d(a)),i=l.fromAngle(d(-a));t.setMagnitude(this.width/2),i.setMagnitude(this.width/2);let s=l.zero();s.add(t),s.sub(i);let n=l.zero();n.add(t),n.add(i);let o=l.zero();o.sub(t),o.add(i);let c=l.zero();c.sub(t),c.sub(i),this.points=[s,n,o,c]}}var f=(h=>(h[h.left=0]="left",h[h.right=1]="right",h[h.top=2]="top",h))(f||{});class b extends P{constructor(t,i,s,n){super(t,i,s);r(this,"aliasingBorder",2);r(this,"wallType");this.wallType=n,this.initialize()}createPoints(){let t=l.fromAngle(d(a)),i=l.fromAngle(d(-a));t.setMagnitude(this.width/2+this.aliasingBorder),i.setMagnitude(this.width/2+this.aliasingBorder);let s=this.position.copy();switch(s.add(t),s.sub(i),this.wallType){case f.top:s.y-=this.height+this.aliasingBorder,this.createTopWall(s);break;case f.left:this.createSideWall(s,1);break;case f.right:this.createSideWall(s,-1);break}}render(t){t.drawShape(this.points)}createSideWall(t,i){let s=l.fromAngle(d(i*a));s.setMagnitude(i*-(this.width+this.aliasingBorder));let n=t.copy();n.add(s);let o=n.copy(),c=t.copy();o.y-=this.height+this.aliasingBorder,c.y-=this.height+this.aliasingBorder,this.points=[t,n,o,c]}createTopWall(t){let i=t.copy(),s=t.copy(),n=t.copy(),o=l.fromAngle(d(a)),c=l.fromAngle(d(-a));o.setMagnitude(-this.width-this.aliasingBorder),c.setMagnitude(this.width+this.aliasingBorder),i.add(o),s.add(c),n.add(o),n.add(c);let v=i.copy(),M=s.copy();v.y+=this.aliasingBorder,M.y+=this.aliasingBorder,t.y+=this.aliasingBorder,this.points=[t,v,i,n,s,M]}}class D extends H{constructor(t,i,s){super(t);r(this,"topFace");r(this,"leftFace");r(this,"rightFace");r(this,"width");r(this,"height");r(this,"dark",w.grayScale(100));r(this,"middle",w.grayScale(175));r(this,"light",w.grayScale(230));this.width=i,this.height=s,this.topFace=new b(t,this.width,this.height,f.top),this.leftFace=new b(t,this.width,this.height,f.left),this.rightFace=new b(t,this.width,this.height,f.right)}render(t){t.setFill(this.light),this.topFace.render(t),t.setFill(this.dark),this.leftFace.render(t),t.setFill(this.middle),this.rightFace.render(t)}}class F{constructor(e,t){r(this,"x");r(this,"y");r(this,"cellShape");r(this,"child");this.x=e,this.y=t;let i=l.fromAngle(d(a));i.setMagnitude(this.x*u);let s=l.fromAngle(d(-a));s.setMagnitude(this.y*u);let n=l.zero();n.add(i),n.add(s),this.cellShape=new A(n,u,0)}draw(e){this.cellShape.render(e)}addChild(e){this.child=e}getChild(){return this.child}removeChild(){this.child=null}isOccupied(){return this.child!=null}}class I{constructor(e){r(this,"_cellCount");r(this,"cells");this._cellCount=e,this.fillGrid()}get cellCount(){return this._cellCount}fillGrid(){this.cells=[];for(let e=-this._cellCount;e<=this._cellCount;e++){this.cells[e+this._cellCount]=[];for(let t=-this._cellCount;t<=this._cellCount;t++)this.cells[e+this._cellCount].push(new F(e,t))}}draw(e){for(let t=0;t<this.cells.length;t++)for(let i=0;i<this.cells[t].length;i++)this.cells[t][i].draw(e)}addCellChild(e,t,i){this.cells[e+this._cellCount][t+this._cellCount].addChild(i)}getCellChild(e,t){return this.cells[e+this._cellCount][t+this._cellCount].getChild()}removeCellChild(e,t){return this.cells[e+this._cellCount][t+this._cellCount].removeChild()}isCellOccupied(e,t){return this.cells[e+this._cellCount][t+this._cellCount].isOccupied()}}class R extends x{constructor(){super();r(this,"position",new l(0,0));r(this,"xDirectionVector");r(this,"yDirectionVector");r(this,"halfScreen");this.xDirectionVector=l.fromAngle(d(a)),this.yDirectionVector=l.fromAngle(d(-a))}initialize(){super.initialize(),this.halfScreen=new l(this.windowHandler.canvasWidth/2,this.windowHandler.canvasHeight/2)}transformScene(t){let i=this.position.copy();i.add(this.halfScreen),t.translate(i.x,i.y)}worldToScreen(t,i){let s=new l(0,0),n=this.xDirectionVector.copy(),o=this.yDirectionVector.copy();return n.setMagnitude(t*u),o.setMagnitude(i*u),s.add(n),s.add(o),s}onResize(t){super.onResize(t),this.halfScreen=new l(this.width/2,this.height/2)}}class $ extends z{constructor(t,i){super();r(this,"grid");r(this,"camera");r(this,"showGrid",!0);this.width=t,this.height=i,this.camera=new R,this.grid=new I(10)}start(){this.camera.initialize(),this.initialize()}preDraw(){this.renderer.resetTransform(),this.renderer.setFill(w.grayScale(0)),this.renderer.clear(this.width,this.height),this.camera.transformScene(this.renderer),this.showGrid&&(this.renderer.setStroke(w.grayScale(55)),this.renderer.setStrokeWidth(1),this.grid.draw(this.renderer))}drawObjects(){this.preSortY(),super.drawObjects()}preSortY(){this.renderables.sort(function(t,i){return t.position.y-i.position.y})}}class G extends ${constructor(t,i,s){super(t,i);r(this,"mouseHandler");r(this,"cellCursor");this.mouseHandler=s,this.cellCursor=new k(l.zero(),u,0)}start(){super.start(),this.mouseHandler.registerMouseClick(this,this.handleClick)}draw(){super.draw(),this.renderGridCursor()}renderGridCursor(){let t=this.mouseHandler.worldMousePosition.x,i=this.mouseHandler.worldMousePosition.y,s=this.grid.cellCount;if(t<-s||t>s||i<-s||i>s)return;let n=this.camera.worldToScreen(t,i);this.cellCursor.position=n,this.cellCursor.isUnder=this.grid.isCellOccupied(t,i),this.cellCursor.render(this.renderer)}handleClick(t){let i=t.detail.data.worldMousePosition.x,s=t.detail.data.worldMousePosition.y,n=this.grid.cellCount;i<-n||i>n||s<-n||s>n||(this.grid.isCellOccupied(i,s)?this.removeCube(i,s):this.addCube(i,s))}addCube(t,i){let s=new D(this.camera.worldToScreen(t,i),u,u);this.addObject(s),this.grid.addCellChild(t,i,s)}removeCube(t,i){let s=this.grid.getCellChild(t,i);this.removeObject(s),this.grid.removeCellChild(t,i)}}class j{constructor(){r(this,"canvas");r(this,"canvasWidth",1600);r(this,"canvasHeight",900);r(this,"context");r(this,"renderer");r(this,"mouseHandler");r(this,"windowHandler");r(this,"currentScene");r(this,"uiManager")}initialize(e){this.canvas=e,this.context=e.getContext("2d"),this.windowHandler=y.getInstance(),this.windowHandler.initialize(e),this.renderer=C.getInstance(),this.renderer.initialize(this.context),this.mouseHandler=new T(this.canvas),this.mouseHandler.initialize(),this.currentScene=new G(this.canvasWidth,this.canvasHeight,this.mouseHandler),this.uiManager=new B,console.log(`Iskon v${_} - Initialized`)}start(){this.currentScene.start(),this.draw()}draw(){this.currentScene.render(),this.uiManager.render(),window.requestAnimationFrame(()=>this.draw())}}window.onload=()=>{console.log("Iskon - Initializing");let h=new j,e=document.getElementById("canvas");h.initialize(e),h.start()};
