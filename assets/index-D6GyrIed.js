var S=Object.defineProperty;var v=(l,e,t)=>e in l?S(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var r=(l,e,t)=>(v(l,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const a=30,u=20;function d(l){return l*Math.PI/180}class n{constructor(e,t){r(this,"x");r(this,"y");r(this,"_oX");r(this,"_oY");r(this,"magnitude");this.x=e,this.y=t,this._oX=e,this._oY=t,this.updateMagnitude()}static fromAngle(e){return new n(Math.cos(e),Math.sin(e))}static zero(){return new n(0,0)}normalize(){this.x=this.x/this.magnitude,this.y=this.y/this.magnitude,this.updateMagnitude()}updateMagnitude(){this.magnitude=Math.sqrt(this.x*this.x+this.y*this.y)}setMagnitude(e){this.magnitude==0&&(this.x=this._oX,this.y=this._oY,this.updateMagnitude()),this.x=this.x*e/this.magnitude,this.y=this.y*e/this.magnitude,this.updateMagnitude()}add(e){return this.x+=e.x,this.y+=e.y,this}sub(e){return this.x-=e.x,this.y-=e.y,this}mult(e){return this.x*=e,this.y*=e,this}copy(){return new n(this.x,this.y)}}class z extends EventTarget{constructor(){super(...arguments);r(this,"eventDispatcher",new Comment("event-dispatcher"))}register(t,i){this.internalRegister(i.bind(t))}internalRegister(t){this.eventDispatcher.addEventListener("click",function(i){t(i)})}dispatch(t){let i=new CustomEvent("click",{detail:{data:t}});this.eventDispatcher.dispatchEvent(i)}}class P{constructor(){r(this,"mousePosition");r(this,"worldMousePosition");r(this,"canvas");r(this,"screenTileWidth");r(this,"screenTileHeight");r(this,"bus");this.mousePosition=new n(0,0),this.worldMousePosition=new n(0,0),this.bus=new z}initialize(e){this.setTileSize(),this.canvas=e,this.canvas.onmousemove=t=>this.onMouseMove(t),this.canvas.onclick=t=>this.onMouseClick(t)}registerMouseClick(e,t){this.bus.register(e,t)}onMouseMove(e){this.updateMouseValues(e)}onMouseClick(e){this.updateMouseValues(e),this.bus.dispatch({mousePosition:this.mousePosition,worldMousePosition:this.worldMousePosition})}updateMouseValues(e){let t=e.offsetX,i=e.offsetY,s=Math.floor(-(t-400)/this.screenTileWidth+.5+(i-400)/this.screenTileHeight),o=Math.floor(-(i-400)/this.screenTileHeight+.5+-(t-400)/this.screenTileWidth);this.mousePosition.x=t,this.mousePosition.y=i,this.worldMousePosition.x=s,this.worldMousePosition.y=o}setTileSize(){let e=n.fromAngle(d(a)),t=n.fromAngle(d(-a));e.setMagnitude(u/2),t.setMagnitude(u/2);let i=n.zero().add(e).sub(t),s=n.zero().add(e).add(t),o=n.zero().sub(e).add(t),h=n.zero().sub(e).sub(t);this.screenTileHeight=i.y-o.y,this.screenTileWidth=h.x-s.x}}const g=class g{constructor(){r(this,"context")}static getInstance(){return g.instance||(g.instance=new g),g.instance}initialize(e){this.context=e}setFill(e){this.context.fillStyle=e}setStroke(e){this.context.strokeStyle=e}clear(e,t){this.context.fillRect(0,0,e,t)}drawShape(e){this.context.beginPath();for(let t=0;t<e.length;t++)this.context.lineTo(e[t].x,e[t].y);this.context.fill()}drawLines(e){this.context.beginPath();for(let t=0;t<e.length;t++)this.context.lineTo(e[t].x,e[t].y);this.context.closePath(),this.context.stroke()}drawCircle(e,t,i){this.context.beginPath(),this.context.arc(e,t,i,0,Math.PI*2),this.context.closePath(),this.context.fill()}translate(e,t){this.context.translate(e,t)}resetTransform(){this.context.setTransform(1,0,0,1,0,0)}setStrokeWidth(e){this.context.lineWidth=e}};r(g,"instance");let f=g;class p{static RGB(e,t,i){return`rgb(${e},${t},${i})`}static RGBA(e,t,i,s){return`rgba(${e},${t},${i},${s/255})`}static grayScale(e){return`rgb(${e},${e},${e})`}}class x{constructor(e){r(this,"position");this.position=e}render(e){}}class b extends x{constructor(t,i,s){super(t);r(this,"points");r(this,"width");r(this,"height");this.width=i,this.height=s,this.points=[]}initialize(){this.createPoints()}createPoints(){}}class M extends b{constructor(e,t,i){super(e,t,i),this.initialize()}render(e){e.drawLines(this.points)}createPoints(){let e=n.fromAngle(d(a)),t=n.fromAngle(d(-a));e.setMagnitude(this.width/2),t.setMagnitude(this.width/2);let i=this.position.copy();i.add(e),i.sub(t);let s=this.position.copy();s.add(e),s.add(t);let o=this.position.copy();o.sub(e),o.add(t);let h=this.position.copy();h.sub(e),h.sub(t),this.points=[i,s,o,h]}}class A extends M{constructor(){super(...arguments);r(this,"isUnder",!1);r(this,"baseColor",p.RGBA(222,105,255,200));r(this,"deleteColor",p.RGBA(201,26,61,125))}render(t){let i=this.points[0].copy().add(this.position),s=this.points[1].copy().add(this.position),o=this.points[2].copy().add(this.position),h=this.points[3].copy().add(this.position);t.setFill(this.isUnder?this.deleteColor:this.baseColor),t.drawShape([i,s,o,h])}createPoints(){let t=n.fromAngle(d(a)),i=n.fromAngle(d(-a));t.setMagnitude(this.width/2),i.setMagnitude(this.width/2);let s=n.zero();s.add(t),s.sub(i);let o=n.zero();o.add(t),o.add(i);let h=n.zero();h.sub(t),h.add(i);let c=n.zero();c.sub(t),c.sub(i),this.points=[s,o,h,c]}}var w=(l=>(l[l.left=0]="left",l[l.right=1]="right",l[l.top=2]="top",l))(w||{});class m extends b{constructor(t,i,s,o){super(t,i,s);r(this,"aliasingBorder",2);r(this,"wallType");this.wallType=o,this.initialize()}createPoints(){let t=n.fromAngle(d(a)),i=n.fromAngle(d(-a));t.setMagnitude(this.width/2+this.aliasingBorder),i.setMagnitude(this.width/2+this.aliasingBorder);let s=this.position.copy();switch(s.add(t),s.sub(i),this.wallType){case w.top:s.y-=this.height+this.aliasingBorder,this.createTopWall(s);break;case w.left:this.createSideWall(s,1);break;case w.right:this.createSideWall(s,-1);break}}render(t){t.drawShape(this.points)}createSideWall(t,i){let s=n.fromAngle(d(i*a));s.setMagnitude(i*-(this.width+this.aliasingBorder));let o=t.copy();o.add(s);let h=o.copy(),c=t.copy();h.y-=this.height+this.aliasingBorder,c.y-=this.height+this.aliasingBorder,this.points=[t,o,h,c]}createTopWall(t){let i=t.copy(),s=t.copy(),o=t.copy(),h=n.fromAngle(d(a)),c=n.fromAngle(d(-a));h.setMagnitude(-this.width-this.aliasingBorder),c.setMagnitude(this.width+this.aliasingBorder),i.add(h),s.add(c),o.add(h),o.add(c);let y=i.copy(),C=s.copy();y.y+=this.aliasingBorder,C.y+=this.aliasingBorder,t.y+=this.aliasingBorder,this.points=[t,y,i,o,s,C]}}class k extends x{constructor(t,i,s){super(t);r(this,"topFace");r(this,"leftFace");r(this,"rightFace");r(this,"width");r(this,"height");r(this,"dark",p.grayScale(100));r(this,"middle",p.grayScale(175));r(this,"light",p.grayScale(230));this.width=i,this.height=s,this.topFace=new m(t,this.width,this.height,w.top),this.leftFace=new m(t,this.width,this.height,w.left),this.rightFace=new m(t,this.width,this.height,w.right)}render(t){t.setFill(this.light),this.topFace.render(t),t.setFill(this.dark),this.leftFace.render(t),t.setFill(this.middle),this.rightFace.render(t)}}class T{constructor(e,t){r(this,"x");r(this,"y");r(this,"cellShape");r(this,"child");this.x=e,this.y=t;let i=n.fromAngle(d(a));i.setMagnitude(this.x*u);let s=n.fromAngle(d(-a));s.setMagnitude(this.y*u);let o=n.zero();o.add(i),o.add(s),this.cellShape=new M(o,u,0)}draw(e){this.cellShape.render(e)}addChild(e){this.child=e}getChild(){return this.child}removeChild(){this.child=null}isOccupied(){return this.child!=null}}class B{constructor(e){r(this,"_cellCount");r(this,"cells");this._cellCount=e,this.fillGrid()}get cellCount(){return this._cellCount}fillGrid(){this.cells=[];for(let e=-this._cellCount;e<=this._cellCount;e++){this.cells[e+this._cellCount]=[];for(let t=-this._cellCount;t<=this._cellCount;t++)this.cells[e+this._cellCount].push(new T(e,t))}}draw(e){for(let t=0;t<this.cells.length;t++)for(let i=0;i<this.cells[t].length;i++)this.cells[t][i].draw(e)}addCellChild(e,t,i){this.cells[e+this._cellCount][t+this._cellCount].addChild(i)}getCellChild(e,t){return this.cells[e+this._cellCount][t+this._cellCount].getChild()}removeCellChild(e,t){return this.cells[e+this._cellCount][t+this._cellCount].removeChild()}isCellOccupied(e,t){return this.cells[e+this._cellCount][t+this._cellCount].isOccupied()}}class O{constructor(e){r(this,"position",new n(0,0));r(this,"screenSize");r(this,"halfScreen");r(this,"xDirectionVector");r(this,"yDirectionVector");this.screenSize=e.copy(),this.halfScreen=new n(this.screenSize.x/2,this.screenSize.y/2),this.xDirectionVector=n.fromAngle(d(a)),this.yDirectionVector=n.fromAngle(d(-a)),document.onkeypress=t=>this.updateTransform(t)}transformScene(e){let t=this.position.copy();t.add(this.halfScreen),e.translate(t.x,t.y)}updateTransform(e){e.keyCode==122&&this.position.y++,e.keyCode==115&&this.position.y--,e.keyCode==100&&this.position.x++,e.keyCode==113&&this.position.x--}worldToScreen(e,t){let i=new n(0,0),s=this.xDirectionVector.copy(),o=this.yDirectionVector.copy();return s.setMagnitude(e*u),o.setMagnitude(t*u),i.add(s),i.add(o),i}}class F{constructor(e,t){r(this,"width");r(this,"height");r(this,"renderables",[]);r(this,"renderer");r(this,"grid");r(this,"camera");r(this,"showGrid",!0);this.width=e,this.height=t,this.renderer=f.getInstance(),this.camera=new O(new n(e,t)),this.grid=new B(10)}start(){}render(){this.preDraw(),this.draw()}preDraw(){this.renderer.resetTransform(),this.renderer.setFill(p.grayScale(0)),this.renderer.clear(this.width,this.height),this.camera.transformScene(this.renderer),this.showGrid&&(this.renderer.setStroke(p.grayScale(55)),this.renderer.setStrokeWidth(1),this.grid.draw(this.renderer))}draw(){this.drawObjects()}drawObjects(){this.preSortY();for(let e=0;e<this.renderables.length;e++)this.renderables[e].render(this.renderer)}preSortY(){this.renderables.sort(function(e,t){return e.position.y-t.position.y})}addObject(e){this.renderables.push(e)}removeObject(e){let t=this.renderables.indexOf(e);this.renderables.splice(t,1)}}class H extends F{constructor(t,i,s){super(t,i);r(this,"mouseHandler");r(this,"cellCursor");this.mouseHandler=s,this.cellCursor=new A(n.zero(),u,0)}start(){this.mouseHandler.registerMouseClick(this,this.handleClick)}draw(){super.draw(),this.renderer.setFill(p.RGB(255,0,255)),this.renderGridCursor()}renderGridCursor(){let t=this.mouseHandler.worldMousePosition.x,i=this.mouseHandler.worldMousePosition.y,s=this.grid.cellCount;if(t<-s||t>s||i<-s||i>s)return;let o=this.camera.worldToScreen(t,i);this.cellCursor.position=o,this.cellCursor.isUnder=this.grid.isCellOccupied(t,i),this.cellCursor.render(this.renderer)}handleClick(t){let i=t.detail.data.worldMousePosition.x,s=t.detail.data.worldMousePosition.y,o=this.grid.cellCount;i<-o||i>o||s<-o||s>o||(this.grid.isCellOccupied(i,s)?this.removeCube(i,s):this.addCube(i,s))}addCube(t,i){let s=new k(this.camera.worldToScreen(t,i),u,u);this.addObject(s),this.grid.addCellChild(t,i,s)}removeCube(t,i){let s=this.grid.getCellChild(t,i);this.removeObject(s),this.grid.removeCellChild(t,i)}}class _{constructor(){r(this,"version","0.01");r(this,"canvas");r(this,"canvasWidth",800);r(this,"canvasHeight",800);r(this,"context");r(this,"renderer");r(this,"mouseHandler");r(this,"currentScene")}initialize(e){this.canvas=e,this.context=e.getContext("2d"),this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,this.renderer=f.getInstance(),this.renderer.initialize(this.context),this.mouseHandler=new P,this.mouseHandler.initialize(this.canvas),this.currentScene=new H(this.canvasWidth,this.canvasHeight,this.mouseHandler),console.log(`Iskon v${this.version} - Initialized`)}start(){this.currentScene.start(),this.draw()}draw(){this.currentScene.render(),window.requestAnimationFrame(()=>this.draw())}}window.onload=()=>{console.log("Iskon - Initializing");let l=new _,e=document.getElementById("canvas");l.initialize(e),l.start()};
